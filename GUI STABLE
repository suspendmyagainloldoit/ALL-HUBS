-- Modern OrionLib GUI Library
-- Features: Tabs, Sections, Dropdowns, Binds, Textboxes, Colorpickers, Premium Locks

local OrionLib = {}
OrionLib.Flags = {}
OrionLib.Themes = {
	Default = {
		Main = Color3.fromRGB(30, 30, 30),
		Second = Color3.fromRGB(40, 40, 40),
		Text = Color3.fromRGB(255, 255, 255),
		TextDark = Color3.fromRGB(180, 180, 180)
	}
}
OrionLib.SelectedTheme = "Default"

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Utilities
local function Create(class, props, children)
	local obj = Instance.new(class)
	if props then
		for k, v in pairs(props) do
			obj[k] = v
		end
	end
	if children then
		for _, child in ipairs(children) do
			child.Parent = obj
		end
	end
	return obj
end

local function Tween(obj, properties, duration, style, direction)
	style = style or Enum.EasingStyle.Quad
	direction = direction or Enum.EasingDirection.Out
	TweenService:Create(obj, TweenInfo.new(duration, style, direction), properties):Play()
end

local function AddTheme(obj, themeKey)
	if themeKey == "Text" then
		obj.TextColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Text
	elseif themeKey == "TextDark" then
		obj.TextColor3 = OrionLib.Themes[OrionLib.SelectedTheme].TextDark
	elseif themeKey == "Main" then
		obj.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Main
	elseif themeKey == "Second" then
		obj.BackgroundColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Second
	end
	return obj
end

local function SaveCfg(gameId)
	-- Placeholder for configuration saving logic
end

-- ======== Tab / Section System ========
function OrionLib:CreateTab(TabConfig)
	local TabFunction = {}
	local Container = Create("Frame")
	TabFunction.Container = Container

	function TabFunction:AddSection(SectionConfig)
		local SectionFrame = Create("Frame", {
			Size = UDim2.new(1, 0, 0, 26),
			Parent = Container
		})
		local Holder = Create("Frame", {
			Size = UDim2.new(1,0,0,0),
			Position = UDim2.new(0,0,0,23),
			Name = "Holder"
		}, {Create("UIListLayout")})
		SectionFrame.Parent = Container
		SectionFrame.Holder = Holder

		local SectionFunction = {}
		-- Element methods will attach here
		function SectionFunction:AddDropdown(DropdownConfig)
			DropdownConfig = DropdownConfig or {}
			local Dropdown = {Value = DropdownConfig.Default or "...", Options = DropdownConfig.Options or {}, Buttons = {}, Type = "Dropdown", Callback = DropdownConfig.Callback or function() end}
			local DropdownFrame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Holder})
			-- Selected Label
			local Selected = Create("TextLabel", {
				Text = Dropdown.Value,
				Size = UDim2.new(1, -24, 1, 0),
				Position = UDim2.new(0,12,0,0),
				TextXAlignment = Enum.TextXAlignment.Left,
				Font = Enum.Font.GothamBold,
				TextSize = 14
			})
			DropdownFrame.Parent = Holder
			DropdownFrame.F = {Selected = Selected}
			local MaxElements = 10

			local function AddOptions(options)
				for _, opt in ipairs(options) do
					local Btn = Create("TextButton", {
						Text = opt,
						Size = UDim2.new(1,0,0,28),
						BackgroundTransparency = 1,
						Parent = DropdownFrame
					})
					Btn.MouseButton1Click:Connect(function()
						Dropdown:Set(opt)
						SaveCfg(game.GameId)
					end)
					Dropdown.Buttons[opt] = Btn
				end
			end

			function Dropdown:Refresh(options, clear)
				if clear then
					for _, btn in pairs(self.Buttons) do btn:Destroy() end
					self.Options = {}
					self.Buttons = {}
				end
				self.Options = options
				AddOptions(self.Options)
			end

			function Dropdown:Set(value)
				if not table.find(self.Options, value) then
					self.Value = "..."
				else
					self.Value = value
				end
				Selected.Text = self.Value
				Dropdown.Callback(self.Value)
			end

			Dropdown:Refresh(Dropdown.Options, false)
			Dropdown:Set(Dropdown.Value)
			if DropdownConfig.Flag then OrionLib.Flags[DropdownConfig.Flag] = Dropdown end
			return Dropdown
		end

		function SectionFunction:AddBind(BindConfig)
			BindConfig = BindConfig or {}
			local Bind = {Value = BindConfig.Default or Enum.KeyCode.Unknown, Type = "Bind", Binding = false, Callback = BindConfig.Callback or function() end}
			-- Bind Frame
			local Frame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Holder})
			local Label = Create("TextLabel", {Text = BindConfig.Name or "Bind", Size = UDim2.new(1,-40,1,0), Position = UDim2.new(0,12,0,0)}, {Frame})
			local Btn = Create("TextButton", {Text = Bind.Value.Name or Bind.Value, Size = UDim2.new(0,24,0,24), Position = UDim2.new(1,-32,0.5,0), AnchorPoint = Vector2.new(1,0.5)}, {Frame})

			function Bind:Set(key)
				self.Value = key
				Btn.Text = key.Name or key
				self.Binding = false
			end

			Btn.MouseButton1Click:Connect(function()
				self.Binding = true
				Btn.Text = ""
			end)

			UserInputService.InputBegan:Connect(function(input)
				if Bind.Binding then
					local key = input.KeyCode ~= Enum.KeyCode.Unknown and input.KeyCode or input.UserInputType
					Bind:Set(key)
					Bind.Callback(key)
					SaveCfg(game.GameId)
				elseif input.KeyCode == Bind.Value then
					Bind.Callback()
				end
			end)

			if BindConfig.Flag then OrionLib.Flags[BindConfig.Flag] = Bind end
			return Bind
		end

		function SectionFunction:AddTextbox(TextboxConfig)
			TextboxConfig = TextboxConfig or {}
			local Textbox = {Value = TextboxConfig.Default or "", Callback = TextboxConfig.Callback or function() end}
			local Frame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Holder})
			local Box = Create("TextBox", {
				Text = Textbox.Value,
				PlaceholderText = "Input",
				TextSize = 14,
				Font = Enum.Font.GothamSemibold,
				BackgroundTransparency = 1,
				TextColor3 = OrionLib.Themes[OrionLib.SelectedTheme].Text,
				ClearTextOnFocus = false,
				Size = UDim2.new(1,-24,1,0),
				Position = UDim2.new(0,12,0,0)
			}, {Frame})

			Box.FocusLost:Connect(function()
				Textbox.Callback(Box.Text)
				if TextboxConfig.TextDisappear then Box.Text = "" end
			end)

			return Textbox
		end

		function SectionFunction:AddColorpicker(ColorpickerConfig)
			ColorpickerConfig = ColorpickerConfig or {}
			local Picker = {Value = ColorpickerConfig.Default or Color3.fromRGB(255,255,255), Type = "Colorpicker", Callback = ColorpickerConfig.Callback or function() end}
			local Frame = Create("Frame", {Size = UDim2.new(1,0,0,38), Parent = Holder})
			local Btn = Create("TextButton", {Text = "", BackgroundColor3 = Picker.Value, Size = UDim2.new(0,24,0,24), Position = UDim2.new(1,-32,0.5,0), AnchorPoint = Vector2.new(1,0.5)}, {Frame})

			function Picker:Set(color)
				self.Value = color
				Btn.BackgroundColor3 = color
				self.Callback(color)
				SaveCfg(game.GameId)
			end

			Btn.MouseButton1Click:Connect(function()
				-- Colorpicker toggle logic here (expand with Hue/HSV selection)
			end)

			if ColorpickerConfig.Flag then OrionLib.Flags[ColorpickerConfig.Flag] = Picker end
			return Picker
		end

		return SectionFunction
	end

	if TabConfig.PremiumOnly then
		for i,v in pairs(TabFunction) do
			TabFunction[i] = function() end
		end
	end

	return TabFunction
end

function OrionLib:Destroy()
	-- Remove the main UI
end

return OrionLib
